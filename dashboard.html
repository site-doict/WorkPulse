<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>User Dashboard - WorkPulse</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>

<h2>Dashboard</h2>
<p id="welcome"></p>
<p id="clock" style="font-size: 18px; font-weight: bold;"></p>

<button id="inBtn">Mark In</button>
<button id="outBtn">Mark Out</button>
<button id="logoutBtn">Logout</button>

<h3>Last 7 Days Attendance</h3>
<ul id="attendanceList"></ul>

<script type="module">
  import { checkSession, logoutUser } from "./js/auth.js";
  import { loadAttendance, markIn, markOut } from "./js/dashboard.js";

  const user = await checkSession(); // get current user
  document.getElementById("welcome").innerText = `Welcome, ${user.email}`;

  function updateClock() {
  const now = new Date();
  const options = {
    weekday: "short",
    year: "numeric",
    month: "short",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    hour12: true,
    timeZone: "Asia/Dhaka"
  };
  const timeString = now.toLocaleString("en-US", options);
  document.getElementById("clock").innerText = timeString;
}

// Update immediately
updateClock();

// Update every second
setInterval(updateClock, 1000);


  // Load attendance initially
  const attendanceListEl = document.getElementById("attendanceList");
  async function renderAttendance() {
    const data = await loadAttendance(user.id);
    attendanceListEl.innerHTML = "";
    data.forEach(a => {
  const li = document.createElement("li");

  // convert UTC to BD timezone
  const inTime = a.in_time ? new Date(a.in_time).toLocaleTimeString("en-US", { hour12: true, timeZone: "Asia/Dhaka" }) : "-";
  const outTime = a.out_time ? new Date(a.out_time).toLocaleTimeString("en-US", { hour12: true, timeZone: "Asia/Dhaka" }) : "-";

  // date in BD timezone
  const dateBD = new Date(a.date + "T00:00:00Z").toLocaleDateString("en-GB", { weekday: "short", day: "2-digit", month: "short", year: "numeric", timeZone: "Asia/Dhaka" });

  li.textContent = `${dateBD} | In: ${inTime} | Out: ${outTime}`;
  attendanceListEl.appendChild(li);
});
  }

  renderAttendance();

  document.getElementById("inBtn").addEventListener("click", async () => {
    await markIn(user.id);
    renderAttendance();
  });

  document.getElementById("outBtn").addEventListener("click", async () => {
    await markOut(user.id);
    renderAttendance();
  });

  document.getElementById("logoutBtn").addEventListener("click", logoutUser);
</script>

</body>
</html>


